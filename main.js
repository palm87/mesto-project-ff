(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-9",headers:{authorization:"10c1d3be-59bf-42c2-a7cc-3e9744607a63","Content-Type":"application/json"}},t="/users/me",n="/cards";function o(e){return e.ok?e.json():Promise.reject(error)}function r(e){console.log("Возникла ошибка: "+e)}function c(t){var n=e.baseUrl+t;return fetch(n,{headers:e.headers}).then(o)}function u(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",c=e.baseUrl+t,u=JSON.stringify(n);return fetch(c,{method:r,body:u,headers:e.headers}).then(o)}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",l)}function i(){document.querySelector(".popup_is-opened").classList.remove("popup_is-opened"),document.removeEventListener("keydown",l)}function l(e){"Escape"===e.key&&i()}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(e){e.target.classList.contains("popup")&&i(),e.target.classList.contains("popup__close")&&i()}))}));var s,p,d=document.querySelector("#card-template").content,_=document.querySelector(".places__list"),f=document.forms["delete-confirmation"],m=document.querySelector(".popup_type_delete");function v(e,t,n,o){var r=d.querySelector(".card").cloneNode(!0),c=r.querySelector(".card__title"),u=r.querySelector(".card__image"),i=r.querySelector(".card__like-counter"),l=r.querySelector(".card__like-button"),_=r.querySelector(".card__delete-button");return c.textContent=e.name,u.src=e.link,u.alt=e.name,i.textContent=e.likes.length,function(e,t){return t===e.owner._id}(e,t)||_.remove(),_.addEventListener("click",(function(){s=e,p=r,a(m)})),S(e,t)&&l.classList.add("card__like-button_is-active"),l.addEventListener("click",(function(){n(e,l,t,i)})),u.addEventListener("click",o),r}function y(e,t,n,o){var r=e._id;S(e,n)?q(r,"DELETE",o,e):q(r,"PUT",o,e),t.classList.toggle("card__like-button_is-active")}function S(e,t){return e.likes.map((function(e){return e._id})).some((function(e){return e==t}))}function q(e,t,n,o){u("/cards/likes/".concat(e),{},t).then((function(e){n.textContent=e.likes.length,o.likes=e.likes})).catch(r)}f.addEventListener("submit",(function(e){e.preventDefault(),u("/cards/".concat(s._id),{},"DELETE").catch(r),p.remove(),i()}));var h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function b(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(h.inputErrorClass),n.classList.remove(h.errorClass),n.textContent=""}function E(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(h.inactiveButtonClass):t.classList.add(h.inactiveButtonClass)}function L(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));n.forEach((function(t){b(e,t)}));var o=e.querySelector(t.submitButtonSelector);o.classList.remove(t.inactiveButtonClass),E(n,o)}var C,g=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit"),x=document.forms["edit-profile"],A=document.querySelector(".profile__title"),w=document.querySelector(".profile__description"),P=document.querySelector(".profile__image"),T=document.querySelector(".popup__input_type_name"),B=document.querySelector(".popup__input_type_description"),D=document.forms.avatar,U=document.querySelector(".popup_type_avatar"),j=document.querySelector(".popup__input_avatar_url"),M=document.querySelector(".popup_type_new-card"),O=document.forms["new-place"],H=document.querySelector(".profile__add-button"),N=document.querySelector(".popup__input_type_card-name"),V=document.querySelector(".popup__input_type_url"),z=(document.forms["delete-confirmation"],document.querySelector(".popup__delete-confirmation"),document.querySelector(".popup_type_image")),J=document.querySelector(".popup__image"),F=document.querySelector(".popup__caption");function G(e){J.src=e.target.src,J.alt=e.target.alt,F.textContent=e.target.alt,a(z)}function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"before";"before"===t&&_.prepend(e),"after"===t?_.append(e):_.prepend(e)}function K(e){document.querySelector(".popup_is-opened").querySelector(".popup__button").textContent=e?"Сохранение...":"Сохранить"}g.addEventListener("click",(function(){T.value=A.textContent,B.value=w.textContent,L(x,h),a(k)})),P.addEventListener("click",(function(){D.reset(),L(D,h),a(U)})),D.addEventListener("submit",(function(e){e.preventDefault(),K(!0),u("/users/me/avatar",{avatar:j.value},"PATCH").then((function(e){P.style="background-image: url('".concat(e.avatar,"')")})).catch(r).finally((function(e){K(!1),i()}))})),x.addEventListener("submit",(function(e){e.preventDefault(),K(!0);var n={name:T.value,about:B.value};u(t,n,"PATCH").then((function(e){A.textContent=e.name,w.textContent=e.about})).catch(r).finally((function(e){K(!1),i()}))})),H.addEventListener("click",(function(){O.reset(),L(O,h),a(M)})),O.addEventListener("submit",(function(e){e.preventDefault(),K(!0);var t={};t.name=N.value,t.link=V.value,u(n,t,"POST").then((function(t){K(!0),I(v(t,t.owner._id,y,G)),e.target.reset()})).catch(r).finally((function(e){K(!1),i()}))})),C=h,Array.from(document.querySelectorAll(C.formSelector)).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(h.inputSelector)),n=e.querySelector(h.submitButtonSelector);E(t,n),t.forEach((function(o){o.addEventListener("input",(function(){E(t,n),function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessagePattern):t.setCustomValidity(""),t.validity.valid?b(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(h.inputErrorClass),o.textContent=n,o.classList.add(h.errorClass)}(e,t,t.validationMessage)}(e,o)}))}))}(e)})),c(t).then((function(e){A.textContent=e.name,w.textContent=e.about,P.style="background-image: url('".concat(e.avatar,"')")})),Promise.all([c(n),c(t)]).then((function(e){var t=e[0],n=e[1];t.forEach((function(e){I(v(e,n._id,y,G),"after")}))})).catch(r)})();